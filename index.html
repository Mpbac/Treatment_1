<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Car Buying Tips: Get a Good Deal</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
    <style>
    :root {
      --dartmouth-green: #00693e;
      --forest-green: #228B22;
      --off-white: #f8f8f8;
    }

    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background-color: var(--off-white);
        padding: 20px;
        color: #363636;
    }
    .container {
        max-width: 700px; /* Adjusted to match index.html's form-card */
        margin: 20px auto;
        background-color: white; /* This background applies to the main content container */
        padding: 20px; /* Adjusted padding */
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0); /* Stronger shadow */
        border-radius: 10px;
        overflow: hidden;
    }
    
    .hero.is-primary.is-bold {
      background-color: var(--dartmouth-green);
      background-image: none;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0);
    }

    /* --- MODIFIED SECTION FOR INTEGRATED TITLE --- */
    .hero-body .container {
      background-color: transparent; /* Remains transparent as it's part of the hero */
      display: flex;
      align-items: center; /* Vertically center the logo and title */
      justify-content: center; /* Center the logo and title horizontally within the hero-body's container */
      max-width: 700px; /* Ensure inner container matches outer form-card width */
      margin: 0 auto; /* Center the content within the hero-body */
      padding: 1rem 0; /* Adjust internal padding as needed */
    }

   .hero .title {
      color: white;
      font-size: 2.5em;
      font-weight: 600;
      margin-left: 1.5rem; /* Space between logo and title */
      margin-bottom: 0; /* Remove default bottom margin */
      white-space: nowrap; /* Prevent title from wrapping unless explicitly broken */
   }

    .banner-logo {
      max-height: 50px; /* Size of the logo */
      width: auto;
      /* Remove any specific positioning that might make it float */
    }
    /* --- END MODIFIED SECTION --- */

    h2.subtitle {
        color: var(--forest-green);
        font-size: 1.5em; /* Slightly smaller for content sections */
        margin-top: 20px;
        margin-bottom: 10px;
        border-bottom: 1px solid #eee;
        padding-bottom: 5px;
    }
    p {
        line-height: 1.6;
        margin-bottom: 1em;
    }
    ul {
        margin-bottom: 1em;
        margin-left: 20px;
    }
    li {
        margin-bottom: 0.5em;
    }
    .section-header {
        font-weight: bold;
        margin-top: 1.5em;
        margin-bottom: 0.5em;
    }
    .cta-section {
        background-color: #e6ffe6; /* Light green */
        border-left: 5px solid var(--forest-green); /* Forest Green */
        padding: 15px; /* Adjusted padding */
        margin-top: 20px; /* Adjusted margin */
        margin-bottom: 20px; /* Adjusted margin */
        border-radius: 5px;
    }
    .feedback-section {
        margin-top: 30px; /* Adjusted margin */
        padding-top: 20px;
        border-top: 1px solid #ddd;
    }
    .button.is-primary {
        background-color: var(--dartmouth-green);
        border-color: var(--dartmouth-green);
        color: white;
        font-weight: bold;
    }
    .button.is-primary:hover {
        background-color: #005a34;
        border-color: #005a34;
    }
    textarea {
        min-height: 100px; /* Slightly smaller for better fit */
        resize: vertical;
    }
    .footer-message {
        margin-top: 30px; /* Adjusted margin */
        text-align: center;
        font-size: 0.9em; /* Slightly smaller font */
        color: #555;
        padding-top: 15px;
        border-top: 1px dashed #ddd;
    }
    /* Specific Bulma overrides for form elements to match index.html more closely */
    .field {
        margin-bottom: 1rem;
    }
    .label {
        font-weight: 600;
        color: #363636;
        margin-bottom: 0.5rem;
    }
    .control {
        position: relative;
    }
    .radio {
        margin-right: 1em;
        cursor: pointer;
    }
    .textarea {
        border-color: #dbdbdb;
        box-shadow: none;
        transition: border-color 0.3s ease, box-shadow 0.3s ease;
    }
    .textarea:focus {
        border-color: var(--forest-green);
        box-shadow: 0 0 0 0.125em rgba(34, 139, 34, 0.25); /* Green focus glow */
    }
    .message-box.is-success {
        background-color: #e6ffe6;
        color: var(--forest-green);
        border: 1px solid var(--forest-green);
        padding: 10px;
        border-radius: 5px;
    }
    .message-box.is-danger {
        background-color: #ffe6e6;
        color: #a30000;
        border: 1px solid #a30000;
        padding: 10px;
        border-radius: 5px;
    }
    .hidden {
        display: none !important;
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
      .hero-body .container {
            flex-direction: column;
            align-items: center;
      }
      .hero .title {
            margin-left: 0;
            text-align: center;
            font-size: 1.8em;
            margin-top: 10px; /* Space between logo and title on small screens */
      }
      .banner-logo {
            margin-bottom: 0; /* No extra margin on small screens as title is below */
      }
    }
.image-container {
        text-align: center; /* Centers inline-block or inline elements like img */
        margin-top: 20px;    /* Add some space above images */
        margin-bottom: 20px; /* Add some space below images */
    }

    /* General Styling for Content Images */
    .content-image {
        max-width: 100%; /* Ensures image doesn't overflow its parent container */
        height: auto;    /* Maintains aspect ratio */
        display: block;  /* Makes it a block element so margin: auto works */
        margin-left: auto; /* Centers the block element horizontally */
        margin-right: auto; /* Centers the block element horizontally */
        border-radius: 8px; /* Optional: adds slightly rounded corners */
        box-shadow: 0 2px 5px rgba(0,0,0,0.1); /* Optional: subtle shadow for depth */
    }

    /* Styling for smaller, potentially side-by-side images */
    .content-image-small {
        max-width: 48%; /* Adjust width to allow two images side-by-side with some gap */
        height: auto;
        display: inline-block; /* Allows images to sit next to each other */
        vertical-align: middle; /* Aligns them nicely if heights vary slightly */
        margin: 5px; /* Add some space around each small image */
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    /* For containers holding multiple images you want to be side-by-side using flexbox */
    .image-container.flex-images {
        display: flex;
        justify-content: center; /* Centers the group of images */
        align-items: center; /* Aligns them vertically */
        flex-wrap: wrap; /* Allows images to wrap to next line on small screens */
        gap: 20px; /* Space between images */
    }

    /* Responsive adjustments for images on smaller screens */
    @media (max-width: 768px) {
        .content-image-small {
            max-width: 90%; /* On smaller screens, make them stack or take more width */
            display: block;
            margin: 10px auto; /* Center them when stacked */
        }
        .image-container.flex-images {
            flex-direction: column; /* Stack images vertically on small screens */
            gap: 10px; /* Reduce gap when stacked */
        }
    }

</style>


</head>
<body>
    <section class="hero is-primary is-bold">
    <div class="hero-body">
      <div class="container">
        <img src="D-Pine_Rev.png" alt="Dartmouth College Logo" class="banner-logo">
        <h1 class="title">Car Buying Tips: Get a Good Deal</h1>
      </div>
    </div>
  </section>
<div class="container" style="margin-top: 20px; margin-bottom: 20px;">
    <div class="message-box is-success" style="text-align: center; padding: 15px; border-radius: 8px;">
        <p>Thanks for completing the enrollment form. <strong>Please check email used in enrollment to receive your $5</strong>.</p>
        <p>And remember to share pictures of your paperwork if you do end up buying a car in the next month or so! If you do we will send you an additional $20 giftcard! Check out our <a href="documentportal.carbuyingstudy.host.dartmouth.edu" target="_blank">uploader</a> if you want a preview. We will reach out in a couple of weeks to remind you.</p>
    </div>
</div>
   <div class="container">
        <div class="cta-section has-text-centered">
            <p class="is-size-6">One more thing: here are some tips for how to get a good deal on your upcoming car purchase and loan. Feel free to bookmark this page or <a href="Treatment content.pdf" download="Car_Buying_Tips.pdf">download a PDF of these tips</a>.</p>
        </div>

               
         <h2 class="subtitle">Part I. Before Contacting a Dealer</h2>

        <h3 class="section-header">1. Research Which Vehicle and Price are Right for you</h3>
        <ul>
            <li>Clarify your priorities: List your "must-have" features (e.g., all-wheel drive, advanced safety tech) </li>
            <li>Narrow the field: Filter by vehicle class (e.g., compact, SUV, midsize sedan)  </li>
            <li>Check reviews from a trusted source like Consumer Reports, Cars.com, or KBB  </li>
            <li>Decide on a make, model, and year (e.g., a 2025 Ford F-150)  </li>
            <li>Drill down on trims and options: Identify which trim level offers your required features at the best value.  </li>
            <li>Get a ballpark of what you should be paying. Check a trusted source like [TrueCar, Cars.com, Edmunds] for what people in your area are paying for your target vehicle.  </li>
        </ul>
        <div class="image-container">
            <img src="1-3.png" alt="Description of the image" class="content-image-small">
            <div>
        <h3 class="section-header">2. Get A Bank or Credit-Union Pre-Approval</h3>
        <ul>
            <li>Financing rates & terms are negotiable! Dealers profit when you pay more.  </li>
            <li>Shop other lenders for pre-approval: A bank or credit-union pre-approval can give you a lower rate, forcing dealers to beat it.  </li>
        </ul>
                 <div class="image-container">
            <img src="4-3.png" alt="Description of the image" class="content-image-small">
            <div>
        <h3 class="section-header">3. Research Your Trade-In Separately</h3>
        <ul>
            <li>Get a ballpark of what you should be getting: Get at least two independent value estimates from trusted sources like Consumer Reports or Kelley Blue Book (KBB)  </li>
        </ul>
                <div class="image-container">
            <img src="3-4.png" alt="Description of the image" class="content-image-small">
            <div>
        <h2 class="subtitle">Part II. Dealing with Dealers</h2>

        <h3 class="section-header">4. Shop Around for Your Exact Vehicle</h3>
        <ul>
            <li>Don't just take the first offer! Not shopping around can cost you thousands.  </li>
            <li>Insist on getting the Out-the-Door (OTD) price: Make sure the quote shows the car's base cost plus every fee.  
                <ul>
                    <li>Example of what to say: "Could you give me the bottom-line out-the-door price with no surprises on fees or addons?"  </li>
                </ul>
            </li>
            <li>Get several OTD prices: Email, call, or visit at least three dealers.  </li>
            <li>While you're at it, get separate quotes for financing (you'll need your credit score handy for this) and your trade-in, if you have one.  
                <ul>
                    <li>Example of what to say: "What's the APR you're offering for my credit score? Can you quote me the total cost with and without financing through you?"  </li>
                    <li>Example of what to say: "If I trade this in today, how much will I get back after all fees?" </li>
                </ul>
            </li>
        </ul>
                 <div class="image-container">
            <img src="2-1.png" alt="Description of the image" class="content-image-small">
            <div>
 
        <h3 class="section-header">5. Negotiate Like a Pro</h3>
        <ul>
            <li>Negotiate each part of the deal separately! Dealers try to bundle together the car, financing, trade-in, and add-ons to keep you from negotiating effectively. 
                <ul>
                    <li>Example of what to say: "We can talk about what you have to offer on financing after we finalize the price of the car."  </li>
                    <li>Another example: "We can talk about my potential trade-in later, after we finalize the price of the car."  </li>
                </ul>
            </li>
            <li>Focus on prices and rates, not monthly payments. Getting you focused on the monthly almost always lines the dealer's pocket at your expense.  
                <ul>
                    <li>Example of what to say: "I'm not focused on the monthly payment- that's the oldest sales trick in the book! I'm focused on the out-the-door price."  </li>
                </ul>
            </li>
            <li>Leverage your outside offers (see Steps 2-4, and 6). Be ready to walk away if the dealer doesn't meet or beat them.  
                <ul>
                    <li>Example of what to say on car or trade-in price: "I have an offer for $ from another dealer. Can you beat that?"  </li>
                    <li>Example of what to say on financing: "I have an offer for _% for months with no fees and no money down. Can you beat that?"  </li>
                </ul>
            </li>
            <li>Firm up as much as you can before you even set foot in the dealership. Once you're at the dealer, they will try to wear you down and create time pressure.  </li>
        </ul>

        <h3 class="section-header">6. Deny Add-Ons and Junk Fees, Defend Your Dollars</h3>
        <ul>
            <li>Decline unnecessary add-ons: Dealers add overpriced "must-have" add-ons (e.g., extended warranties, service contracts, coating, GAP insurance, etc.). Just say no to anything you haven't researched and decided you need! 
                <ul>
                    <li>Example of what to say: "No thanks, I don't need that"  </li>
                    <li>Example of what to say: "No thanks, I'm going aftermarket on that"  </li>
                </ul>
            </li>
            <li>Arm yourself with aftermarket offers: IF you're interested in a particular add-on, shop for it first, just like you did for the car itself!  
                <ul>
                    <li>Example of what to say: "No thanks, I found a much better deal with" </li>
                    <li>Example of what to say: "Here's my quote from an aftermarket dealer. Can you beat it?"  </li>
                </ul>
            </li>
            <li>Junk the junk fees: Dealers add both required fees (e.g., sales tax, title, registration, and licensing, doc fee) and optional charges not tied to any legal or real expense (e.g., dealer prep, advertising, VIN etching, market adjustment).  
                <ul>
                    <li>Example of what to say: "I see there's a $X VIN etching. I don't need it, please strike it from the out-the-door price."  </li>
                    <li>Another example of what to say: "Can you remove the $X market adjustment? Similar models are selling at $Y."  </li>
                </ul>
            </li>
        </ul>
                  <div class="image-container">
            <img src="2.png" alt="Description of the image" class="content-image-small">
            <div>
        <div class="feedback-section">
            <p class="is-size-6 has-text-centered mb-3">Please help our study by answering two more questions:</p>

            <form id="feedbackForm">
                <input type="hidden" id="timeSpentField" name="timeSpentOnPageMs" value="0">
                <input type="hidden" id="pageLoadTime" name="pageLoadTime" value="">
                <input type="hidden" id="pageUnloadTime" name="pageUnloadTime" value="">
                <input type="hidden" id="submissionTimestamp" name="submissionTimestamp" value="">
                <input type="hidden" id="demographicsSubmissionId" name="demographicsSubmissionId" value="">

                <div class="field">
                    <label class="label">Are these tips useful?</label>
                    <div class="control">
                        <label class="radio">
                            <input type="radio" name="tipsUseful" value="Yes" required> Yes
                        </label>
                        <label class="radio">
                            <input type="radio" name="tipsUseful" value="No"> No
                        </label>
                    </div>
                </div>

                <div class="field">
                    <label class="label">Have you found any other useful tips? Please describe, or paste links:</label>
                    <div class="control">
                        <textarea class="textarea" name="otherTips" placeholder="e.g., 'I found that checking CarGurus helped me compare prices.' or paste links here."></textarea>
                    </div>
                </div>

                <div class="field has-text-centered">
                    <button class="button is-primary" type="submit" id="submitFeedbackBtn">Submit Feedback</button>
                </div>
            </form>
            <div id="feedback-thank-you" class="message-box is-success hidden mt-3">
                <p>Thank you for your feedback!</p>
            </div>
            <div id="feedback-error" class="message-box is-danger hidden mt-3">
                <p>There was an error submitting your feedback. Please try again.</p>
            </div>
        </div>

        <p class="footer-message">Thanks again for joining our study. We'll be in touch soon.</p>
    </div>

    <script>
        // !!! REPLACE with your actual Google Apps Script Web App URL for treatment page data submission !!!
        const treatmentScriptURL = "https://script.google.com/macros/s/AKfycbz74V9JXvlPx80mveoft0ODn9gm2z-YMqUijFoPZt3vy44CpOyOTwQJy8ADkuMDIVzcjg/exec"; // ** IMPORTANT: Change this **

        let pageLoadStartTime;

        function setTimestamp(field) {
            const now = new Date();
            const timestampString = now.getFullYear() + '-' +
                                   ('0' + (now.getMonth() + 1)).slice(-2) + '-' +
                                   ('0' + now.getDate()).slice(-2) + ' ' +
                                   ('0' + now.getHours()).slice(-2) + ':' +
                                   ('0' + now.getMinutes()).slice(-2) + ':' +
                                   ('0' + now.getSeconds()).slice(-2);
            field.value = timestampString;
        }

        document.addEventListener('DOMContentLoaded', () => {
            // Ensure all DOM elements are loaded before trying to access them
            const timeSpentField = document.getElementById('timeSpentField');
            const pageLoadTimeField = document.getElementById('pageLoadTime');
            const submissionTimestampField = document.getElementById('submissionTimestamp');
            const demographicsSubmissionIdField = document.getElementById('demographicsSubmissionId');
            const feedbackForm = document.getElementById('feedbackForm');
            const feedbackThankYou = document.getElementById('feedback-thank-you');
            const feedbackError = document.getElementById('feedback-error');
            const submitFeedbackBtn = document.getElementById('submitFeedbackBtn');


            pageLoadStartTime = new Date().getTime();
            if (pageLoadTimeField) setTimestamp(pageLoadTimeField); // Record page load time

            // Get demographicsSubmissionId from URL if available
            const urlParams = new URLSearchParams(window.location.search);
            const demographicsId = urlParams.get('submissionId');
            if (demographicsId && demographicsSubmissionIdField) {
                demographicsSubmissionIdField.value = demographicsId;
            }

            // Only add event listener if the form exists
            if (feedbackForm) {
                feedbackForm.addEventListener('submit', async function(e) {
                    e.preventDefault();

                    // Only update loading state if button exists
                    if (submitFeedbackBtn) {
                        submitFeedbackBtn.classList.add('is-loading');
                        submitFeedbackBtn.disabled = true;
                    }

                    // Hide messages from previous attempts
                    if (feedbackThankYou) feedbackThankYou.classList.add('hidden');
                    if (feedbackError) {
                        feedbackError.classList.add('hidden');
                        feedbackError.textContent = ''; // Clear any previous error text
                    }

                    const pageUnloadEndTime = new Date().getTime(); // Capture time at submission
                    const timeOnPageMs = pageUnloadEndTime - pageLoadStartTime;
                    if (timeSpentField) timeSpentField.value = timeOnPageMs;
                    if (submissionTimestampField) setTimestamp(submissionTimestampField); // Record submission time

                    const formData = new FormData(feedbackForm);
                    const params = new URLSearchParams();
                    for (const pair of formData.entries()) {
                        params.append(pair[0], pair[1]);
                    }
                    const formDataString = params.toString();

                    try {
                        const response = await fetch(treatmentScriptURL, {
                            method: "POST",
                            redirect: "follow", // browser follows redirects
                            body: formDataString,
                            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                            //credentials: 'omit' // Added for clarity, default for same-origin
                        });

                        // Check if the HTTP status code indicates success (200-299 range)
                        if (!response.ok) {
                            let serverMessage = 'Unknown server error.';
                            try {
                                const errorData = await response.json(); // Try to parse as JSON
                                serverMessage = errorData.message || `Server status ${response.status}.`;
                            } catch (jsonParseError) {
                                // If it's not JSON, get the raw text for debugging
                                const rawResponse = await response.text();
                                serverMessage = `Server status ${response.status}. Response: ${rawResponse.substring(0, 100)}...`;
                            }
                            throw new Error(serverMessage); // Throw to be caught by the outer catch
                        }

                        // Parse the JSON response
                        const data = await response.json();
                        if (data && data.status === "success") {
                            if (feedbackThankYou) feedbackThankYou.classList.remove("hidden");
                            if (feedbackForm) feedbackForm.classList.add("hidden"); // Hide the form after successful submission
                        } else {
                            // Server responded with 200 OK, but 'status' in JSON is not 'success'
                            console.error('Submission failed as per server response:', data.message);
                            if (feedbackError) {
                                feedbackError.textContent = data.message || 'Submission failed. Server did not indicate success.';
                                feedbackError.classList.remove("hidden");
                            }
                        }
                    } catch (error) {
                        // This catch block handles network errors, CORS errors, and errors thrown above
                        console.error('Error submitting feedback:', error);
                        if (feedbackError) {
                            feedbackError.textContent = `Error: ${error.message || 'There was a network error or problem with the server. Please try again.'}`;
                            feedbackError.classList.remove("hidden");
                        }
                    } finally {
                        // Always remove loading state and re-enable button if form is still visible
                        if (submitFeedbackBtn) {
                            submitFeedbackBtn.classList.remove('is-loading');
                            if (feedbackForm && !feedbackForm.classList.contains('hidden')) {
                                submitFeedbackBtn.disabled = false;
                            }
                        }
                    }
                });
            } else {
                console.warn("Feedback form element not found. Form submission will not work.");
            }
        });

        // The 'beforeunload' event for 'pageUnloadTime' is generally unreliable for sending data
        // because the browser might kill the process before the fetch completes.
        // The current method of calculating timeOnPageMs at submission is more robust for study data.
        // If you absolutely need to capture unload time for *all* exits, consider navigator.sendBeacon.
        /*
        window.addEventListener('beforeunload', () => {
            const pageUnloadEndTime = new Date().getTime();
            const timeOnPageMs = pageUnloadEndTime - pageLoadStartTime;
            const pageUnloadTimeField = document.getElementById('pageUnloadTime');
            if (pageUnloadTimeField) {
                pageUnloadTimeField.value = new Date().toISOString(); // More robust time string
            }
            // For sending data on unload, `fetch` might be blocked. `navigator.sendBeacon` is better.
            // But since your design submits on button click, this part might not be strictly necessary for data.
        });
        */
    </script>
</body>
</html>
